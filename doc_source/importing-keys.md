# Importing key material in AWS KMS keys<a name="importing-keys"></a>

You can create a [AWS KMS keys](concepts.md#kms_keys) \(KMS key\) with key material that you supply\. 

A KMS key is a logical representation of an encryption key\. The metadata for a KMS key includes the ID of [key material](concepts.md#key-material) used to encrypt and decrypt data\. When you [create a KMS key](create-keys.md), by default, AWS KMS generates the key material for that KMS key\. But you can create a KMS key without key material and then import your own key material into that KMS key, a feature often known as "bring your own key" \(BYOK\)\.

![\[Image NOT FOUND\]](http://docs.aws.amazon.com/kms/latest/developerguide/images/import-key.png)

**Note**  
AWS KMS does not support decrypting any AWS KMS ciphertext outside of AWS KMS, even if the ciphertext was encrypted under a KMS key with imported key material\. AWS KMS does not publish the ciphertext format this task requires, and the format might change without notice\.

Imported key material is supported only for [symmetric encryption KMS keys](concepts.md#symmetric-cmks) in AWS KMS key stores, including [multi\-Region symmetric encryption KMS keys](multi-region-keys-import.md)\. It is not supported on [asymmetric KMS keys](symmetric-asymmetric.md#asymmetric-cmks), [HMAC KMS keys](hmac.md), or KMS keys in [custom key stores](custom-key-store-overview.md)\.

When you use imported key material, you remain responsible for the key material while allowing AWS KMS to use a copy of it\. You might choose to do this for one or more of the following reasons:
+ To prove that you generated the key material using a source of entropy that meets your requirements\.
+ To use key material from your own infrastructure with AWS services, and to use AWS KMS to manage the lifecycle of that key material within AWS\.
+ To set an expiration time for the key material in AWS and to [manually delete it](importing-keys-delete-key-material.md), but to also make it available again in the future\. In contrast, [scheduling key deletion](deleting-keys.md#deleting-keys-how-it-works) requires a waiting period of 7 to 30 days, after which you cannot recover the deleted KMS key\.
+ To own the original copy of the key material, and to keep it outside of AWS for additional durability and disaster recovery during the complete lifecycle of the key material\.

Imported key material is supported only for [symmetric encryption KMS keys](concepts.md#symmetric-cmks) in AWS KMS key stores, including [multi\-Region symmetric KMS keys](multi-region-keys-import.md)\. It is not supported on [asymmetric KMS keys](symmetric-asymmetric.md#asymmetric-cmks), [HMAC KMS keys](hmac.md), or KMS keys in [custom key stores](custom-key-store-overview.md)\. 

You can monitor the use and management of a KMS key with imported key material\. AWS KMS records an entry in your AWS CloudTrail log when you [create the KMS key](ct-createkey.md), [download the public key and import token](ct-getparametersforimport.md), and [import the key material](ct-importkeymaterial.md)\. AWS KMS also records an entry when you [manually delete imported key material](importing-keys-delete-key-material.md) or when AWS KMS [deletes expired key material](ct-deleteexpiredkeymaterial.md)\.

For information about important differences between KMS keys with imported key material and those with key material generated by AWS KMS, see [About imported key material](#importing-keys-considerations)\.

**Regions**

Imported key material is supported in all AWS Regions that AWS KMS supports\. The requirements for imported key material are different in China Regions\. For details, see [Importing key material step 3: Encrypt the key material](importing-keys-encrypt-key-material.md)

**Topics**
+ [About imported key material](#importing-keys-considerations)
+ [Permissions for importing key material](#importing-keys-permissions)
+ [How to import key material](#importing-keys-overview)
+ [How to reimport key material](#reimport-key-material)
+ [How to identify KMS keys with imported key material](#identify-imported-keys)

## About imported key material<a name="importing-keys-considerations"></a>

Before you decide to import key material into AWS KMS, you should understand the following characteristics of imported key material\.

**You generate the key material**  
You are responsible for generating the key material using a source of randomness that meets your security requirements\. The key material you import must be a 256\-bit symmetric encryption key, except in China Regions, where it must be a 128\-bit symmetric encryption key\.

**You can delete the key material**  
You can delete imported key material from a KMS key, immediately rendering the KMS key unusable\. Also, when you import key material into a KMS key, you can determine whether the key expires and [set its expiration date](importing-keys-create-cmk.md)\. When the expiration date arrives, AWS KMS [deletes the key material](importing-keys-delete-key-material.md)\. Without key material, the KMS key cannot be used in any cryptographic operation\. To restore the key, you must reimport the same key material into the key\. 

**Can't change the key material**  
When you import key material into a KMS key, the KMS key is permanently associated with that key material\. You can [reimport the same key material](#reimport-key-material), but you cannot import different key material into that KMS key\. Also, you cannot [enable automatic key rotation](rotate-keys.md) for a KMS key with imported key material\. However, you can [manually rotate a KMS key](rotate-keys.md#rotate-keys-manually) with imported key material\. 

**Can't change the key material origin**  
KMS keys designed for imported key material have an [origin](concepts.md#key-origin) value of `EXTERNAL` that cannot be changed\. You cannot convert a KMS key for imported key material to use key material from any other source, including AWS KMS\.

**Can't decrypt with any other KMS key**  
When you encrypt data under a KMS key, the ciphertext is permanently associated with the KMS key and its key material\. It cannot be decrypted with any other KMS key, including a different KMS key with the same key material\. This is a security feature of KMS keys\.  
The only exception is [multi\-Region keys](multi-region-keys-overview.md), which are designed to be interoperable\. For details, see [Why aren't all KMS keys with imported key material interoperable?](multi-region-keys-import.md#mrk-import-why)\.

**No portability or escrow features**  
The ciphertexts that AWS KMS produces are not portable\. AWS KMS does not support decrypting any AWS KMS ciphertext outside of AWS KMS, even if the ciphertext was encrypted under a KMS key with imported key material\. AWS KMS does not publish the ciphertext format this task requires, and the format might change without notice\.   
Also, you cannot use any AWS tools, such as the [AWS Encryption SDK](https://docs.aws.amazon.com/encryption-sdk/latest/developer-guide/) or [Amazon S3 client\-side encryption](https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingClientSideEncryption.html), to decrypt AWS KMS ciphertexts\.  
As a result, you cannot use keys with imported key material to support key escrow arrangements where an authorized third party with conditional access to key material can decrypt certain ciphertexts outside of AWS KMS\. To support key escrow, use the [AWS Encryption SDK](https://docs.aws.amazon.com/encryption-sdk/latest/developer-guide/java-example-code.html#java-example-multiple-providers) to encrypt your message under a key that is independent of AWS KMS\.

**You're responsible for availability and durability**  
You are responsible for the key material's overall availability and durability\. AWS KMS is designed to keep imported key material highly available\. But AWS KMS does not maintain the durability of imported key material at the same level as key material that AWS KMS generates\. To restore imported key material that has been deleted from a KMS key, you must retain a copy of the key material in a system that you control\. Then, you can reimport it into the KMS key\.  
This difference is meaningful in the following cases:  
+ When you [set an expiration time](importing-keys-import-key-material.md) for your imported key material, AWS KMS deletes the key material after it expires\. AWS KMS does not delete the KMS key or its metadata\. You cannot delete key material that AWS KMS generates from a KMS key and you cannot set AWS KMS key material to expire, although you can [rotate it](rotate-keys.md)\.
+ When you [manually delete imported key material](importing-keys-delete-key-material.md), AWS KMS deletes the key material but does not delete the KMS key or its metadata\. In contrast, [scheduling key deletion](deleting-keys.md#deleting-keys-how-it-works) requires a waiting period of 7 to 30 days, after which AWS KMS permanently deletes the KMS key, its metadata, and its key material\.
+ In the unlikely event of certain region\-wide failures that affect AWS KMS \(such as a total loss of power\), AWS KMS cannot automatically restore your imported key material\. However, AWS KMS can restore the KMS key and the metadata\.

## Permissions for importing key material<a name="importing-keys-permissions"></a>

To create and manage KMS keys with imported key material, the user needs permission for the operations in this process\. You can provide the `kms:GetParametersForImport`, `kms:ImportKeyMaterial`, and `kms:DeleteImportedKeyMaterial` permissions in the key policy when you create the KMS key\. The `kms:ImportKeyMaterial` permission is not included in the default permissions for key administrators, so you need to add it manually\.

To create KMS keys with imported key material, the principal needs the following permissions\.
+ [kms:CreateKey](customer-managed-policies.md#iam-policy-example-create-key) \(IAM policy\)
  + To limit this permission to KMS keys with imported key material, use the [kms:KeyOrigin](policy-conditions.md#conditions-kms-key-origin) policy condition with a value of `EXTERNAL`\.

    ```
    {
      "Version": "2012-10-17",
      "Statement": {
        "Sid": "IAM policy to create KMS keys with no key material" 
        "Effect": "Allow",
        "Resource": "*",
        "Principal": {
          "AWS": "arn:aws:iam::111122223333:role/KMSAdminRole"
        },
        "Action": "kms:CreateKey",
        "Condition": {
          "StringEquals": {
            "kms:KeyOrigin": "EXTERNAL"
        }
      }
    }
    ```
+ [kms:GetParametersForImport](https://docs.aws.amazon.com/kms/latest/APIReference/API_GetParametersForImport.html) \(Key policy or IAM policy\)
  + To limit this permission to requests that use a particular wrapping algorithm and wrapping key spec, use the [kms:WrappingAlgorithm](policy-conditions.md#conditions-kms-wrapping-algorithm) and [kms:WrappingKeySpec](policy-conditions.md#conditions-kms-wrapping-key-spec) policy conditions\. 
+ [kms:ImportKeyMaterial](https://docs.aws.amazon.com/kms/latest/APIReference/API_ImportKeyMaterial.html) \(Key policy or IAM policy\)
  + To allow or prohibit key material that expires and control the expiration date, use the [kms:ExpirationModel](policy-conditions.md#conditions-kms-expiration-model) and [kms:ValidTo](policy-conditions.md#conditions-kms-valid-to) policy conditions\.

To reimport imported key material, the principal needs the [kms:GetParametersForImport](https://docs.aws.amazon.com/kms/latest/APIReference/API_GetParametersForImport.html) and [kms:ImportKeyMaterial](https://docs.aws.amazon.com/kms/latest/APIReference/API_ImportKeyMaterial.html) permissions\.

To delete imported key material, the principal needs [kms:DeleteImportedKeyMaterial](https://docs.aws.amazon.com/kms/latest/APIReference/API_DeleteImportedKeyMaterial.html) permission\.

## How to import key material<a name="importing-keys-overview"></a>

The following overview explains how to import your key material into AWS KMS\. For more details about each step in the process, see the corresponding topic\.

1. [Create a symmetric encryption KMS key with no key material](importing-keys-create-cmk.md) – The key spec must be `SYMMETRIC_DEFAULT` and the origin must be `EXTERNAL`\. A key origin of `EXTERNAL` indicates that the key is designed for imported key material and prevents AWS KMS from generating key material for the KMS key\. In a later step you will import your own key material into this KMS key\.

1. [Download the public key and import token](importing-keys-get-public-key-and-token.md) – After completing step 1, download a public key and an import token\. These items protect your key material while it's imported to AWS KMS\.

1. [Encrypt the key material](importing-keys-encrypt-key-material.md) – Use the public key that you downloaded in step 2 to encrypt the key material that you created on your own system\.

1. [Import the key material](importing-keys-import-key-material.md) – Upload the encrypted key material that you created in step 3 and the import token that you downloaded in step 2\.

   When the import operation completes successfully, the key state of the KMS key changes from `PendingImport` to `Enabled`\. You can now use the KMS key in cryptographic operations\.

AWS KMS records an entry in your AWS CloudTrail log when you [create the KMS key](ct-createkey.md), [download the public key and import token](ct-getparametersforimport.md), and [import the key material](ct-importkeymaterial.md)\. AWS KMS also records an entry when you delete imported key material or when AWS KMS [deletes expired key material](ct-deleteexpiredkeymaterial.md)\. 

## How to reimport key material<a name="reimport-key-material"></a>

If you manage a KMS key with imported key material, you might need to reimport the key material, either because the key material expired, or because the key material was accidentally deleted or lost\. 

You must reimport the same key material that was originally imported into the KMS key\. You cannot import different key material into a KMS key\. Also, AWS KMS cannot create key material for a KMS key that is created without key material\.

To reimport key material, use the same procedure that you used to [import the key material](#importing-keys-overview) the first time, with the following exceptions\.
+ Use an existing KMS key, instead of creating a new KMS key\. You can skip [Step 1](importing-keys-create-cmk.md) of the import procedure\.
+ If the KMS key is associated with imported key material, you must [delete the existing imported key material](importing-keys-delete-key-material.md) before you reimport the key material\. 

Each time you import key material to a KMS key, you need to [download and use a new wrapping key and import token](importing-keys-get-public-key-and-token.md) for the KMS key\. The wrapping procedure does not affect the content of the key material, so you can use different wrapping keys \(and different import tokens\) to import the same key material\.

## How to identify KMS keys with imported key material<a name="identify-imported-keys"></a>

When you create a KMS key with no key material, the value of the [`Origin`](concepts.md#key-origin) property of the KMS key is `EXTERNAL`, and it cannot be changed\. Unlike the [key state](key-state.md), the `Origin` value doesn't depend on the presence or absence of key material\. 

You can use the `EXTERNAL` origin value to identify KMS keys designed for imported key material\. You can find the key origin in the AWS KMS console or by using the [DescribeKey](https://docs.aws.amazon.com/kms/latest/APIReference/API_DescribeKey.html) operation\. You can also view the properties of the key material, such as whether and when it expires by using the console or the APIs\.

### To identify KMS keys with imported key material \(console\)<a name="identify-imported-keys-console"></a>

1. Open the AWS KMS console at [https://console\.aws\.amazon\.com/kms](https://console.aws.amazon.com/kms)\.

1. To change the AWS Region, use the Region selector in the upper\-right corner of the page\.

1. Use either of the following techniques to view the `Origin` property of your KMS keys\.
   + To add an **Origin** column to your KMS key table, in the upper right corner, choose the **Settings** icon\. Choose **Origin** and choose **Confirm**\. The **Origin** column makes it easy to identify KMS keys with an `EXTERNAL` origin property value\.
   + To find the value of the `Origin` property of a particular KMS key, choose the key ID or alias of the KMS key\. Then choose the **Cryptographic configuration** tab\. The tabs are below the **General configuration** section\.

1. To view detailed information about the key material, choose the **Key material** tab\. This tab appears on the detail page only for KMS keys with imported key material\.

### To identify KMS keys with imported key material \(AWS KMS API\)<a name="identify-imported-keys-api"></a>

Use the [DescribeKey](https://docs.aws.amazon.com/kms/latest/APIReference/API_DescribeKey.html) operation\. The response includes the `Origin` property of the KMS key, the expiration model, and the expiration date, as shown in the following example\.

```
$  aws kms describe-key --key-id 1234abcd-12ab-34cd-56ef-1234567890ab
{
    "KeyMetadata": {
        "KeyId": "1234abcd-12ab-34cd-56ef-1234567890ab",
        "Origin": "EXTERNAL",
        "ExpirationModel": "KEY_MATERIAL_EXPIRES"
        "ValidTo": 1568894400.0,
        "Arn": "arn:aws:kms:us-west-2:111122223333:key/1234abcd-12ab-34cd-56ef-1234567890ab",
        "AWSAccountId": "111122223333",
        "CreationDate": 1568289600.0,
        "Enabled": false,
        "MultiRegion": false,
        "Description": "",
        "KeyUsage": "ENCRYPT_DECRYPT",
        "KeyState": "PendingImport",
        "KeyManager": "CUSTOMER",
        "KeySpec": "SYMMETRIC_DEFAULT",
        "CustomerMasterKeySpec": "SYMMETRIC_DEFAULT",
        "EncryptionAlgorithms": [
            "SYMMETRIC_DEFAULT"
        ]
    }
}
```